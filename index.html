<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Tecsitel - Sistema de Gestión Empresarial Integrado con facturación electrónica, contabilidad y cumplimiento normativo">
    <meta name="author" content="Tecsitel">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#dc143c">
    
    <title>Tecsitel - Sistema de Gestión Empresarial</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://i.imgur.com/6XXdcPR.png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/6XXdcPR.png">
    
    <!-- Estilos en línea para evitar dependencias externas y asegurar la carga visual -->
    <style>
        /* ===========================
           Variables y Base
        =========================== */
        :root {
            --primary: #dc143c; --primary-dark: #a3102d; --white: #ffffff; --dark: #1f2937;
            --gray-100: #f9fafb; --gray-200: #f3f4f6; --gray-300: #d1d5db; --gray-600: #6b7280; --gray-700: #4b5563;
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444; --info: #3b82f6;
            --success-alpha: rgba(16, 185, 129, 0.1); --warning-alpha: rgba(245, 158, 11, 0.1);
            --danger-alpha: rgba(239, 68, 68, 0.1); --info-alpha: rgba(59, 130, 246, 0.1);
            --shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px 0 rgba(0,0,0,.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,.1), 0 10px 10px -5px rgba(0,0,0,.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0,0,0,.25);
            --radius: 8px; --radius-lg: 12px; --radius-xl: 16px; --radius-2xl: 24px; --radius-full: 9999px;
            --header-height: 70px; --sidebar-width: 280px; --bottom-nav-height: 60px;
            --transition: 300ms ease; --transition-slow: 500ms ease;
            --font-sans: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { -webkit-font-smoothing: antialiased; }
        body { font-family: var(--font-sans); background: var(--gray-100); color: var(--dark); }

        /* ===========================
           PANTALLA DE CARGA
        =========================== */
        .loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex; align-items: center; justify-content: center;
            z-index: 10000; transition: opacity var(--transition-slow), visibility var(--transition-slow);
            overflow: hidden;
        }
        .loading-particles { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        .loading-particles .particle {
            position: absolute; background: rgba(255, 255, 255, 0.1); border-radius: 50%;
            animation: float 25s infinite ease-in-out;
        }
        @keyframes float { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-120vh) rotate(720deg); opacity: 0; } }
        .loading-content { text-align: center; position: relative; z-index: 1; animation: fadeIn 1s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .loading-logo {
            width: 140px; height: 140px; background: rgba(255, 255, 255, 0.95); border-radius: var(--radius-2xl);
            padding: 25px; margin: 0 auto 20px; box-shadow: var(--shadow-2xl);
            animation: pulse 2.5s infinite ease-in-out; display: flex; align-items: center; justify-content: center;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.4); } 50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255,255,255,0); } }
        .loading-logo img { width: 100%; height: 100%; object-fit: contain; }
        .loading-title { color: var(--white); font-size: 28px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .loading-status { color: rgba(255, 255, 255, 0.8); font-size: 16px; min-height: 24px; margin-top: 8px; transition: all var(--transition); }
        .loading-status.error { color: #ffcdd2; font-weight: 600; }

        /* ===========================
           App Container y UI General
        =========================== */
        .app-container { display: none; min-height: 100vh; opacity: 0; transition: opacity var(--transition-slow); }
        .app-container.loaded { opacity: 1; display: flex; }
        .sidebar{width:var(--sidebar-width);background:linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);color:var(--white);position:fixed;height:100vh;transition:all var(--transition);z-index:1000;display:flex;flex-direction:column}
        .sidebar-header{padding:30px 20px;text-align:center;border-bottom:1px solid rgba(255,255,255,.1)}.logo{width:80px;height:80px;background:var(--white);border-radius:var(--radius-xl);margin:0 auto 15px;padding:15px;cursor:pointer}.logo img{width:100%;height:100%}.sidebar-title{font-size:20px;font-weight:700;margin:0}.sidebar-subtitle{font-size:14px;opacity:.8;margin-top:4px}.nav-menu{padding:20px 0;flex-grow:1}.nav-item{display:flex;align-items:center;gap:15px;padding:15px 25px;cursor:pointer;transition:background .2s ease, padding-left .2s ease;border:none;background:0 0;color:var(--white);width:100%;text-align:left;font-size:15px}.nav-item.active,.nav-item:hover{background:rgba(255,255,255,.1);padding-left:30px}.main-content{margin-left:var(--sidebar-width);transition:margin-left var(--transition);width:calc(100% - var(--sidebar-width));display:flex;flex-direction:column;min-height:100vh}.header{height:var(--header-height);background:var(--white);box-shadow:var(--shadow);display:flex;align-items:center;justify-content:space-between;padding:0 30px;position:sticky;top:0;z-index:999}.page-title{font-size:24px;font-weight:700}.header-right{display:flex;align-items:center;gap:20px}.user-avatar{width:40px;height:40px;background:var(--primary);color:var(--white);border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;font-weight:700}.content{padding:30px;flex-grow:1}.tab-content{display:none}.tab-content.active{display:block;animation:fadeIn .5s ease}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:var(--white);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow)}.stat-header{display:flex;justify-content:space-between;align-items:flex-start}.stat-value{font-size:28px;font-weight:700}.stat-label{color:var(--gray-600)}.stat-icon{width:48px;height:48px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:24px}.panel{background:var(--white);border-radius:var(--radius-lg);box-shadow:var(--shadow);margin-bottom:24px}.panel-header{padding:20px 24px;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:center}.panel-title{font-size:18px;font-weight:700}.panel-body{padding:24px}.table{width:100%;border-collapse:collapse}.table th,.table td{padding:12px 16px;text-align:left;border-bottom:1px solid var(--gray-200)}.table th{background:var(--gray-100)}.badge{padding:4px 10px;border-radius:var(--radius-full);font-size:12px;font-weight:600}.badge-success{background:var(--success-alpha);color:var(--success)}.badge-warning{background:var(--warning-alpha);color:var(--warning)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:2000}.modal.active{display:flex;align-items:center;justify-content:center;animation:fadeIn .3s ease}.modal-overlay{position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5)}.modal-content{background:var(--white);padding:30px;border-radius:var(--radius-lg);z-index:1;width:90%;max-width:600px;animation:slideUp .3s ease}@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid var(--gray-200)}.modal-title{font-size:20px;font-weight:700}.modal-close{background:0 0;border:none;font-size:24px;cursor:pointer}.modal-footer{margin-top:20px;padding-top:15px;border-top:1px solid var(--gray-200);display:flex;justify-content:flex-end;gap:10px}.btn{padding:10px 20px;border:none;border-radius:var(--radius);cursor:pointer;font-weight:600;transition:all var(--transition)}.btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{background:var(--primary-dark)}.btn-secondary{background:var(--gray-200)}.form-group{margin-bottom:20px}.form-label{display:block;margin-bottom:8px;font-weight:600}.form-input,.form-select,.form-textarea{width:100%;padding:10px;border:1px solid var(--gray-300);border-radius:var(--radius)}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}.toast-container{position:fixed;bottom:20px;right:20px;z-index:3000}.toast{padding:15px;margin-top:10px;border-radius:var(--radius);color:var(--white);box-shadow:var(--shadow-lg);animation:fadeIn .3s}.toast-success{background:var(--success)}.toast-error{background:var(--danger)}.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.8);display:flex;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(2px)}.loading-spinner{width:40px;height:40px;border:4px solid var(--primary-dark);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}
        .alert{padding:16px 20px;border-radius:var(--radius);margin-bottom:20px;display:flex;gap:12px;border:1px solid transparent}.alert-info{background:var(--info-alpha);color:var(--info);border-color:rgba(59,130,246,.2)}.alert-icon{font-size:20px;flex-shrink:0}.alert-content strong{display:block;margin-bottom:4px}.quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:30px}.action-card{background:var(--white);border:2px dashed var(--gray-300);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all var(--transition)}.action-card:hover{border-color:var(--primary);border-style:solid;transform:translateY(-2px);box-shadow:var(--shadow-md)}.action-icon{font-size:32px;margin-bottom:12px}.action-title{font-weight:700;margin-bottom:4px;font-size:16px}.action-desc{font-size:13px;color:var(--gray-600)}.compliance-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;margin-bottom:24px}.compliance-card{background:var(--white);border-radius:var(--radius-lg);padding:24px;box-shadow:var(--shadow)}.compliance-header{display:flex;align-items:center;gap:16px;margin-bottom:20px}.compliance-icon{width:60px;height:60px;border-radius:var(--radius-lg);display:flex;align-items:center;justify-content:center;font-size:32px}.compliance-info h3{margin:0;font-size:20px}.compliance-info p{color:var(--gray-600);margin:0;font-size:14px}.compliance-list{display:flex;flex-direction:column;gap:12px}.compliance-item{display:flex;align-items:center;gap:12px}.check-icon{width:24px;height:24px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;color:var(--white);font-size:14px}.compliance-progress{margin-top:20px}.progress-header{display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px}.progress{height:8px;background:var(--gray-200);border-radius:var(--radius-full);overflow:hidden}.progress-bar{height:100%;background:var(--primary);border-radius:var(--radius-full);transition:width var(--transition)}.employee-info{display:flex;align-items:center;gap:12px}.employee-avatar{width:40px;height:40px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;font-weight:700}.employee-details .employee-name{font-weight:600}.employee-details .employee-role{font-size:12px;color:var(--gray-600)}
        .balance-sheet{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}.balance-section{background:var(--gray-100);padding:20px;border-radius:var(--radius);border-left:4px solid var(--primary)}.balance-section h4{margin:0 0 16px;color:var(--dark);font-size:16px;font-weight:700}.balance-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--gray-200)}.balance-item:last-child{border-bottom:none}.balance-total{font-weight:700;margin-top:12px;padding-top:12px;border-top:2px solid var(--primary);color:var(--dark);display:flex;justify-content:space-between}
        @media(max-width:768px){.sidebar{transform:translateX(-100%);z-index:1001}.sidebar.active{transform:translateX(0)}.main-content{margin-left:0;width:100%}.menu-toggle{display:block!important}.hide-mobile{display:none}}
    </style>
</head>
<body>
    <!-- Pantalla de Carga Mejorada -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-particles" id="loadingParticles"></div>
        <div class="loading-content">
            <div class="loading-logo">
                <img src="https://i.imgur.com/6XXdcPR.png" alt="Tecsitel Logo">
            </div>
            <h1 class="loading-title">TECSITEL</h1>
            <p class="loading-status" id="loadingStatus">Cargando sistema...</p>
        </div>
    </div>

    <!-- Contenedor Principal de la App -->
    <div class="app-container" id="appContainer">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo" onclick="showTab('dashboard')">
                    <img src="https://i.imgur.com/6XXdcPR.png" alt="Tecsitel">
                </div>
                <h2 class="sidebar-title">TECSITEL</h2>
                <p class="sidebar-subtitle">Sistema de Gestión v2.1</p>
            </div>
            <nav class="nav-menu">
                <button class="nav-item active" data-tab="dashboard">
                    <span class="nav-icon">📊</span><span class="nav-text">Dashboard</span>
                </button>
                <button class="nav-item" data-tab="invoices">
                    <span class="nav-icon">📄</span><span class="nav-text">Facturas</span>
                </button>
                <button class="nav-item" data-tab="accounting">
                    <span class="nav-icon">💰</span><span class="nav-text">Contabilidad</span>
                </button>
                <button class="nav-item" data-tab="timetracking">
                    <span class="nav-icon">⏰</span><span class="nav-text">Control Horarios</span>
                </button>
                <button class="nav-item" data-tab="compliance">
                    <span class="nav-icon">⚖️</span><span class="nav-text">Cumplimiento</span>
                </button>
                <button class="nav-item" data-tab="sharepoint">
                    <span class="nav-icon">☁️</span><span class="nav-text">Respaldos</span>
                </button>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <button class="menu-toggle" style="display:none;" onclick="document.getElementById('sidebar').classList.toggle('active')">☰</button>
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="header-right">
                    <div class="user-avatar" id="userAvatar">A</div>
                </div>
            </header>

            <div class="content">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-header"><div class="stat-info"><div class="stat-value" id="totalIncome">S/ 0.00</div><div class="stat-label">Ingresos Totales</div></div><div class="stat-icon" style="background:var(--success-alpha);color:var(--success)">💰</div></div></div>
                        <div class="stat-card"><div class="stat-header"><div class="stat-info"><div class="stat-value" id="pendingInvoices">0</div><div class="stat-label">Facturas Pendientes</div></div><div class="stat-icon" style="background:var(--warning-alpha);color:var(--warning)">📋</div></div></div>
                        <div class="stat-card"><div class="stat-header"><div class="stat-info"><div class="stat-value" id="totalExpenses">S/ 0.00</div><div class="stat-label">Egresos Totales</div></div><div class="stat-icon" style="background:var(--danger-alpha);color:var(--danger)">💳</div></div></div>
                        <div class="stat-card"><div class="stat-header"><div class="stat-info"><div class="stat-value" id="netBalance">S/ 0.00</div><div class="stat-label">Balance Neto</div></div><div class="stat-icon" style="background:var(--info-alpha);color:var(--info)">📈</div></div></div>
                    </div>
                    <div class="panel">
                         <div class="panel-header">
                            <h3 class="panel-title">📊 Actividad Reciente</h3>
                            <button class="btn btn-primary" onclick="showModal('newInvoice')">
                                <span class="btn-icon">➕</span>
                                <span class="btn-text">Nueva Factura</span>
                            </button>
                        </div>
                        <div class="panel-body">
                            <div class="alert alert-info">
                                <span class="alert-icon">ℹ️</span>
                                <div class="alert-content">
                                    <strong>Sistema Actualizado</strong>
                                    Cumpliendo con normativas SUNAT, SUNAFIL y MINTRA.
                                </div>
                            </div>
                            <div class="table-responsive"><table class="table" id="recentInvoicesTable"><thead><tr><th>N° Factura</th><th>Cliente</th><th class="hide-mobile">Total</th><th>Estado</th></tr></thead><tbody><tr><td colspan="4" style="text-align:center;">No hay facturas recientes.</td></tr></tbody></table></div>
                        </div>
                    </div>
                     <div class="quick-actions">
                        <div class="action-card" onclick="showModal('newInvoice')"><div class="action-icon">➕</div><div class="action-title">Nueva Factura</div><div class="action-desc">Crear comprobante</div></div>
                        <div class="action-card" onclick="showModal('registerPayment')"><div class="action-icon">💵</div><div class="action-title">Registrar Cobro</div><div class="action-desc">Ingresar pago</div></div>
                        <div class="action-card" onclick="showTab('timetracking')"><div class="action-icon">⏰</div><div class="action-title">Control Horarios</div><div class="action-desc">Ver asistencia</div></div>
                        <div class="action-card" onclick="exportData()"><div class="action-icon">📤</div><div class="action-title">Exportar Datos</div><div class="action-desc">Descargar CSV</div></div>
                    </div>
                </div>
                
                <!-- Invoices Tab -->
                <div id="invoices" class="tab-content">
                    <div class="panel">
                        <div class="panel-header"><h3 class="panel-title">Todas las Facturas</h3><button class="btn btn-primary" onclick="showModal('newInvoice')">➕ Nueva Factura</button></div>
                        <div class="panel-body"><div class="table-responsive"><table class="table" id="allInvoicesTable"><thead><tr><th>N° Factura</th><th>Cliente</th><th>RUC</th><th>Total</th><th>Estado</th></tr></thead><tbody><tr><td colspan="5" style="text-align:center;">No hay facturas registradas.</td></tr></tbody></table></div></div>
                    </div>
                </div>

                <!-- Accounting Tab -->
                <div id="accounting" class="tab-content">
                    <div class="panel">
                        <div class="panel-header"><h3 class="panel-title">💰 Estado de Situación Financiera</h3></div>
                        <div class="panel-body">
                           <div class="balance-sheet">
                                <div class="balance-section">
                                    <h4>ACTIVOS</h4>
                                    <div class="balance-item"><span>Efectivo y Bancos</span><span id="cashBalance">S/ 50,250.70</span></div>
                                    <div class="balance-item"><span>Cuentas por Cobrar</span><span id="receivables">S/ 15,120.00</span></div>
                                    <div class="balance-item"><span>Inventario</span><span>S/ 8,450.00</span></div>
                                    <div class="balance-total"><span>Total Activos</span><span id="totalAssets">S/ 73,820.70</span></div>
                                </div>
                                <div class="balance-section">
                                    <h4>PASIVOS</h4>
                                    <div class="balance-item"><span>Cuentas por Pagar</span><span>S/ 5,600.00</span></div>
                                    <div class="balance-item"><span>Impuestos por Pagar</span><span id="taxesPayable">S/ 2,721.60</span></div>
                                    <div class="balance-total"><span>Total Pasivos</span><span id="totalLiabilities">S/ 8,321.60</span></div>
                                </div>
                                <div class="balance-section">
                                    <h4>PATRIMONIO</h4>
                                    <div class="balance-item"><span>Capital Social</span><span>S/ 50,000.00</span></div>
                                    <div class="balance-item"><span>Utilidades Retenidas</span><span id="retainedEarnings">S/ 15,499.10</span></div>
                                    <div class="balance-total"><span>Total Patrimonio</span><span id="totalEquity">S/ 65,499.10</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance Tab -->
                <div id="compliance" class="tab-content">
                     <div class="compliance-grid">
                        <div class="compliance-card">
                            <div class="compliance-header"><div class="compliance-icon" style="background:rgba(16,185,129,.1)">🏛️</div><div class="compliance-info"><h3>SUNAT</h3><p>Superintendencia Nacional</p></div></div>
                            <div class="compliance-list"><div class="compliance-item"><div class="check-icon" style="background:var(--success)">✓</div><span>Facturación Electrónica 3.0</span></div><div class="compliance-item"><div class="check-icon" style="background:var(--success)">✓</div><span>Libros Electrónicos al día</span></div><div class="compliance-item"><div class="check-icon" style="background:var(--warning)">!</div><span>PDT 621 - Vence en 10 días</span></div></div>
                            <div class="compliance-progress"><div class="progress-header"><span>Cumplimiento</span><strong>95%</strong></div><div class="progress"><div class="progress-bar" style="width:95%;background:var(--success)"></div></div></div>
                        </div>
                        <div class="compliance-card">
                            <div class="compliance-header"><div class="compliance-icon" style="background:rgba(59,130,246,.1)">⚖️</div><div class="compliance-info"><h3>SUNAFIL</h3><p>Fiscalización Laboral</p></div></div>
                            <div class="compliance-list"><div class="compliance-item"><div class="check-icon" style="background:var(--success)">✓</div><span>T-REGISTRO actualizado</span></div><div class="compliance-item"><div class="check-icon" style="background:var(--success)">✓</div><span>Control de asistencia digital</span></div><div class="compliance-item"><div class="check-icon" style="background:var(--success)">✓</div><span>SCTR vigente</span></div></div>
                            <div class="compliance-progress"><div class="progress-header"><span>Cumplimiento</span><strong>100%</strong></div><div class="progress"><div class="progress-bar" style="width:100%;background:var(--success)"></div></div></div>
                        </div>
                    </div>
                </div>

                <!-- Time Tracking Tab -->
                <div id="timetracking" class="tab-content">
                    <div class="panel">
                        <div class="panel-header"><h3 class="panel-title">⏰ Control de Asistencia Digital</h3></div>
                        <div class="panel-body">
                           <div class="alert alert-info"><span class="alert-icon">ℹ️</span><div class="alert-content"><strong>Cumplimiento SUNAFIL.</strong> El registro de control de asistencia es obligatorio.</div></div>
                           <table class="table">
                               <thead><tr><th>Trabajador</th><th>Entrada</th><th>Salida</th><th>Estado</th></tr></thead>
                               <tbody>
                                   <tr><td><div class="employee-info"><div class="employee-avatar" style="background:#e0f2fe;color:#0284c7">JP</div><div class="employee-details"><div class="employee-name">Juan Pérez</div><div class="employee-role hide-mobile">Técnico</div></div></div></td><td>08:00</td><td>18:30</td><td><span class="badge badge-success">✓ Completo</span></td></tr>
                                   <tr><td><div class="employee-info"><div class="employee-avatar" style="background:#fce7f3;color:#ec4899">MR</div><div class="employee-details"><div class="employee-name">María Rodríguez</div><div class="employee-role hide-mobile">Admin</div></div></div></td><td>08:15</td><td>--:--</td><td><span class="badge badge-warning">⚠️ En jornada</span></td></tr>
                               </tbody>
                           </table>
                        </div>
                    </div>
                </div>

                <!-- SharePoint Tab -->
                <div id="sharepoint" class="tab-content">
                    <div class="panel">
                        <div class="panel-header"><h3 class="panel-title">☁️ Sistema de Respaldos (Simulado)</h3></div>
                        <div class="panel-body">
                            <p>Este es un sistema de respaldo simulado. En una versión de producción, se conectaría a un servicio como SharePoint o S3.</p>
                            <button class="btn btn-primary" onclick="showToast('Iniciando respaldo manual...', 'info')">Iniciar Respaldo Manual</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Nueva Factura -->
    <div class="modal" id="newInvoiceModal">
        <div class="modal-overlay" onclick="closeModal('newInvoice')"></div>
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Nueva Factura</h2><button class="modal-close" onclick="closeModal('newInvoice')">&times;</button></div>
            <form id="invoiceForm" onsubmit="saveInvoice(event)">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">RUC Cliente*</label><input type="text" class="form-input" name="clientRuc" required></div>
                    <div class="form-group"><label class="form-label">Razón Social*</label><input type="text" class="form-input" name="clientName" required></div>
                </div>
                <div class="form-group"><label class="form-label">Descripción*</label><input type="text" class="form-input" name="description" required></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Monto sin IGV*</label><input type="number" step="0.01" class="form-input" name="amount" required oninput="calculateTotal(this.value)"></div>
                    <div class="form-group"><label class="form-label">Total (IGV Incl.)</label><input type="text" class="form-input" name="totalAmount" readonly></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('newInvoice')">Cancelar</button><button type="submit" class="btn btn-primary">Guardar</button></div>
            </form>
        </div>
    </div>
    
    <!-- Modal para Registrar Cobro -->
    <div class="modal" id="registerPaymentModal">
        <div class="modal-overlay" onclick="closeModal('registerPayment')"></div>
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Registrar Cobro</h2><button class="modal-close" onclick="closeModal('registerPayment')">&times;</button></div>
            <form id="paymentForm" onsubmit="savePayment(event)">
                <div class="form-group"><label class="form-label">N° de Factura*</label><input type="text" class="form-input" name="invoiceNumber" placeholder="F001-00001234" required></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Monto Cobrado*</label><input type="number" step="0.01" class="form-input" name="paymentAmount" required></div>
                    <div class="form-group"><label class="form-label">Fecha de Cobro*</label><input type="date" class="form-input" name="paymentDate" required></div>
                </div>
                <div class="form-group"><label class="form-label">Método de Pago</label><select class="form-select" name="paymentMethod"><option>Transferencia</option><option>Efectivo</option><option>Yape/Plin</option></select></div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModal('registerPayment')">Cancelar</button><button type="submit" class="btn btn-primary">Registrar</button></div>
            </form>
        </div>
    </div>


    <div class="toast-container" id="toastContainer"></div>

    <script>
    // ========================================
    // Configuración Global
    // ========================================
    const CONFIG = {
        API_URL: '/.netlify/functions/database',
        VERSION: '4.2.0-dashboard-update',
        IGV_RATE: 0.18,
        LOADING_DURATION: 3000, // Duración de la pantalla de carga en milisegundos
    };

    const AppState = { user: null, invoices: [], transactions: [], invoiceCounter: 1 };

    // ========================================
    // Inicialización
    // ========================================
    document.addEventListener('DOMContentLoaded', async () => {
        setupLoadingAnimation();
        
        const minDelay = new Promise(resolve => setTimeout(resolve, CONFIG.LOADING_DURATION));
        const dataFetch = initializeApp();

        try {
            updateLoadingStatus('Conectando con servidores...', false);
            await Promise.all([dataFetch, minDelay]);
            updateLoadingStatus('¡Sistema listo!', false);
            setTimeout(hideLoadingScreen, 500);
        } catch (error) {
            console.error('Error fatal durante la inicialización:', error);
            updateLoadingStatus(error.message, true);
        }
    });

    async function initializeApp() {
        // Simulación de carga de datos
        await new Promise(resolve => setTimeout(resolve, 1500));
        AppState.user = { avatar: 'A' };
        updateLoadingStatus('Preparando interfaz...', false);
        renderUI();
        setupEventListeners();
    }

    function updateLoadingStatus(message, isError = false) {
        const statusElement = document.getElementById('loadingStatus');
        if (statusElement) {
            statusElement.textContent = message;
            statusElement.classList.toggle('error', isError);
        }
    }

    function hideLoadingScreen() {
        const loadingScreen = document.getElementById('loadingScreen');
        const appContainer = document.getElementById('appContainer');
        if (loadingScreen && appContainer) {
            loadingScreen.style.opacity = '0';
            loadingScreen.style.visibility = 'hidden';
            appContainer.classList.add('loaded');
        }
    }

    function setupLoadingAnimation() {
        const container = document.getElementById('loadingParticles');
        if (!container) return;
        const particleCount = 25; // Número de partículas
        for (let i = 0; i < particleCount; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            const size = Math.random() * 15 + 5;
            p.style.cssText = `
                width:${size}px;
                height:${size}px;
                left:${Math.random()*100}%;
                animation-delay:${Math.random()*25}s;
                animation-duration:${Math.random()*15+10}s;
            `;
            container.appendChild(p);
        }
    }

    // ========================================
    // API y Lógica de Datos (Simulado)
    // ========================================
    async function persistData() {
        showLoadingSpinner();
        try {
            // Simulación de guardado
            await new Promise(resolve => setTimeout(resolve, 800));
            showToast('✅ Cambios guardados (simulado).', 'success');
        } catch (error) {
            showToast('❌ Error al guardar (simulado).', 'error');
        } finally {
            hideLoadingSpinner();
        }
    }

    // ========================================
    // Renderizado de UI
    // ========================================
    function renderUI() {
        document.getElementById('userAvatar').textContent = AppState.user?.avatar || 'U';
        // Aquí irían las funciones de renderizado para cada sección
    }

    // ========================================
    // Lógica de Formularios y Modales
    // ========================================
    async function saveInvoice(event) {
        event.preventDefault();
        const form = event.target;
        const amount = parseFloat(form.amount.value)
        const total = amount * (1 + CONFIG.IGV_RATE);

        const newInvoice = {
            id: Date.now(),
            invoice_number: `F001-${String(AppState.invoiceCounter++).padStart(8, '0')}`,
            client_ruc: form.clientRuc.value,
            client_name: form.clientName.value,
            description: form.description.value,
            amount: amount,
            total: total,
            status: 'Pendiente',
            created_at: new Date().toISOString(),
        };
        AppState.invoices.push(newInvoice);
        
        // Actualizar UI
        const recentTbody = document.querySelector('#recentInvoicesTable tbody');
        recentTbody.innerHTML = `<tr><td>${newInvoice.invoice_number}</td><td>${newInvoice.client_name}</td><td class="hide-mobile">S/ ${newInvoice.total.toFixed(2)}</td><td><span class="badge badge-warning">${newInvoice.status}</span></td></tr>` + recentTbody.innerHTML;

        closeModal('newInvoice');
        form.reset();
        await persistData();
    }
    
    async function savePayment(event) {
        event.preventDefault();
        showToast('✅ Cobro registrado correctamente (simulado).', 'success');
        closeModal('registerPayment');
        document.getElementById('paymentForm').reset();
    }

    function calculateTotal(amount) {
        const total = (parseFloat(amount) || 0) * (1 + CONFIG.IGV_RATE);
        document.querySelector('#invoiceForm [name="totalAmount"]').value = `S/ ${total.toFixed(2)}`;
    }

    function showModal(modalId) { document.getElementById(modalId + 'Modal').classList.add('active'); }
    function closeModal(modalId) { document.getElementById(modalId + 'Modal').classList.remove('active'); }

    // ========================================
    // Eventos y Utilidades
    // ========================================
    function setupEventListeners() {
        document.body.addEventListener('click', e => {
            if (e.target.matches('.modal-overlay')) {
                const modalId = e.target.parentElement.id.replace('Modal', '');
                closeModal(modalId);
            }
            if (e.target.closest('.nav-item')) showTab(e.target.closest('.nav-item').dataset.tab);
        });
        
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.querySelector('#paymentForm [name="paymentDate"]');
        if(dateInput) dateInput.value = today;
    }

    function showTab(tabName) {
        if (!tabName) return;
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        const tabElement = document.getElementById(tabName);
        if(tabElement) tabElement.classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(i => i.classList.toggle('active', i.dataset.tab === tabName));
        
        const title = tabName.charAt(0).toUpperCase() + tabName.slice(1);
        document.getElementById('pageTitle').textContent = title;
    }
    
    function exportData() {
        showToast('📥 Generando reporte CSV...', 'info');
        // Simulación de creación de CSV
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "NumeroFactura,Cliente,RUC,Total,Estado\n";
        AppState.invoices.forEach(inv => {
            csvContent += `${inv.invoice_number},"${inv.client_name}",${inv.client_ruc},${inv.total},${inv.status}\n`;
        });
        
        // Simulación de descarga
        setTimeout(() => {
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "reporte_facturas.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('✅ Reporte descargado.', 'success');
        }, 1500);
    }
    
    function showToast(message, type = 'info') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    function showLoadingSpinner() {
        const overlay = document.createElement('div');
        overlay.id = 'globalLoading';
        overlay.className = 'loading-overlay';
        overlay.innerHTML = `<div class="loading-spinner"></div>`;
        document.body.appendChild(overlay);
    }

    function hideLoadingSpinner() {
        document.getElementById('globalLoading')?.remove();
    }
    </script>
</body>
</html>
